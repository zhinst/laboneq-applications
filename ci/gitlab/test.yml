test:python-3.9:
  stage: test
  image: python:3.9
  tags:
    - linux
    - docker
  script:
    - pip install -r requirements-dev.txt
    - pip install -e .
    - pytest tests -vv

test:python-3.10:
  extends: "test:python-3.9"
  image: python:3.10

test:python-3.11:
  extends: "test:python-3.9"
  image: python:3.11

test:python-3.12:
  extends: "test:python-3.9"
  image: python:3.12

test:coverage:
  extends: "test:python-3.9"
  image: python:3.12
  script:
    - pip install -r requirements-dev.txt
    - pip install -e .
    - pytest tests -v --cov=laboneq_applications --cov=tests --cov-branch --cov-config=ci/coveragerc -n auto
    - coverage xml -o coverage.xml
    - coverage html -d coverage_html
  artifacts:
    paths:
      - coverage_html
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
    expire_in: 1 day
  coverage: '/(?i)total.*? (100(?:\.0+)?\%|[1-9]?\d(?:\.\d+)?\%)$/'

test:notebooks:python-3.9:
  extends: "test:python-3.9"
  script:
    - pip install -r requirements-dev.txt
    - pip install -e .
    - pytest --nbmake examples --nbmake-kernel=python --nbmake-timeout=240 --durations=0
