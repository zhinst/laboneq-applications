lint:python:
  stage: pre-build
  script:
    - uv run --only-group tools ruff check .
  rules:
    - !reference [.non_triggered]

lint:notebooks:docs:
  stage: pre-build
  script:
    - uv run --only-group tools -- nbqa ruff docs/sources
  rules:
    - !reference [.non_triggered]

notebooks:check_no_outputs:
  stage: pre-build
  script:
    - uv run --no-project ci/scripts/notebook_check.py docs
  rules:
    - !reference [.non_triggered]

check:license:
  stage: pre-build
  script:
    - uv run --no-project ci/scripts/check_license.py src/ tests/
  rules:
    - !reference [.non_triggered]

check:lockfile:
  stage: pre-build
  script:
    - uv lock --check
  rules:
    - !reference [.non_triggered]

lint:renovate_config:
  stage: pre-build
  image:
    name: docker-registry.zhinst.com/devops/dockerfiles/renovate:latest
  script:
    - | 
      RENOVATE_ENDPOINT="$CI_API_V4_URL" \
      RENOVATE_PLATFORM="gitlab" \
      renovate-config-validator --strict
  rules:
    - !reference [.non_triggered]
    - changes:
        - renovate.json5
